# REGLAS 0 y 1: agregan una regla a la cadena POSTROUTING de la tabla NAT e indican que cualquier tráfico
# de las subredes 42 y 43 que no vayan a si mismas cambien su IP origen por 172.16.44.1
$IPTABLES -t nat -A POSTROUTING -o eth0   -s 172.16.43.0/24  -d ! 172.16.43.0/24  -j SNAT --to-source 172.16.44.1
$IPTABLES -t nat -A POSTROUTING -o eth0   -s 172.16.42.0/24  -d ! 172.16.42.0/24  -j SNAT --to-source 172.16.44.1

# REGLA2: agrega una regla a la cadena Policy que indica que cualquier paquete TCP destinado al multisrv puerto
# 25 (SMTP) con estado válido se acepte.
$IPTABLES -N Policy
$IPTABLES -A Policy -i +  -p tcp -m tcp  -d 172.16.42.2   --dport 25  -m state --state NEW  -j ACCEPT

# Las siguientes dos reglas son similares a la anterior pero para HTTP y HTTPS.
$IPTABLES -A Policy -i +  -p tcp -m tcp  -d 172.16.42.2   --dport 80  -m state --state NEW  -j ACCEPT
$IPTABLES -A Policy -i +  -p tcp -m tcp  -d 172.16.42.2   --dport 443  -m state --state NEW  -j ACCEPT

# 
$IPTABLES -A Policy -o +  -p tcp -m tcp  -s 172.16.42.2   -d 172.16.44.0/24   --dport 53  -m state --state NEW  -j ACCEPT
$IPTABLES -A Policy -o +  -p udp -m udp  -s 172.16.42.2   -d 172.16.44.0/24   --dport 53  -m state --state NEW  -j ACCEPT

$IPTABLES -A Policy -o +  -p tcp -m tcp  -s 172.16.43.0/24   --dport 22  -m state --state NEW  -j ACCEPT

$IPTABLES -A Policy -o +  -p tcp -m tcp  -s 172.16.43.0/24   --dport 80  -m state --state NEW  -j ACCEPT

$IPTABLES -N Cid3977X1563.0
$IPTABLES -A Policy -i eth1  -p tcp -m tcp  -s 172.16.43.3   --dport 22  -m state --state NEW  -j Cid3977X1563.0
$IPTABLES -A Cid3977X1563.0  -d 172.16.42.1   -j ACCEPT
$IPTABLES -A Cid3977X1563.0  -d 172.16.43.1   -j ACCEPT
$IPTABLES -A Cid3977X1563.0  -d 172.16.44.1   -j ACCEPT

$IPTABLES -N Cid4314X1563.0
$IPTABLES -A Policy -i eth1  -p tcp -m tcp  -s 172.16.43.4   --dport 22  -m state --state NEW  -j Cid4314X1563.0
$IPTABLES -A Cid4314X1563.0  -d 172.16.42.1   -j ACCEPT
$IPTABLES -A Cid4314X1563.0  -d 172.16.43.1   -j ACCEPT
$IPTABLES -A Cid4314X1563.0  -d 172.16.44.1   -j ACCEPT

$IPTABLES -N Cid4370X1563.0
$IPTABLES -A Policy -i eth1  -p tcp -m tcp  -s 172.16.43.5   --dport 22  -m state --state NEW  -j Cid4370X1563.0
$IPTABLES -A Cid4370X1563.0  -d 172.16.42.1   -j ACCEPT
$IPTABLES -A Cid4370X1563.0  -d 172.16.43.1   -j ACCEPT
$IPTABLES -A Cid4370X1563.0  -d 172.16.44.1   -j ACCEPT

$IPTABLES -N RULE_9
$IPTABLES -A Policy  -j RULE_9
$IPTABLES -A RULE_9  -j LOG  --log-level info --log-prefix "RULE 9 -- DENY "
$IPTABLES -A RULE_9  -j DROP
